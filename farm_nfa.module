<?php

/**
 * @file
 * farmOS module for Uganda's National Forestry Authority.
 */

/**
 * Implements hook_menu().
 */
function farm_nfa_menu() {

  // Plantation plan budget form.
  $items['farm/plan/%farm_plan/budget'] = array(
    'title' => 'Budget',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('farm_nfa_plantation_plan_budget_form', 2),
    'access callback' => 'farm_forest_plantation_plan_access',
    'access arguments' => array(2),
    'file' => 'farm_nfa.plantation.budget.inc',
    'type' => MENU_LOCAL_TASK,
    'weight' => 15,
  );

  return $items;
}

/**
 * Load NFA budget items from the database for a particular plan.
 *
 * @param $plan_id
 *   The plan ID.
 *
 * @return array
 *   Returns an array of budget items from the {farm_nfa_budget} database.
 */
function farm_nfa_budget_items($plan_id) {

  // Start with an empty array.
  $items = array();

  // If a plan ID isn't provided, bail.
  if (empty($plan_id)) {
    return $items;
  }

  // Perform the query.
  $query = 'SELECT * FROM {farm_nfa_budget} WHERE plan_id = :plan_id';
  $args = array(':plan_id' => $plan_id);
  $result = db_query($query, $args);

  // Assemble the results.
  while ($item = $result->fetchAssoc()) {
    $items[] = $item;
  }

  // Return the items.
  return $items;
}

/**
 * Implements hook_theme
 */
function farm_nfa_theme() {
  return array(
    'farm_nfa_plantation_plan_budget_form' => array(
      'render element' => 'form',
      'file' => 'farm_nfa.plantation.budget.inc',
    ),
  );
}
